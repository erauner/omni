# Containerd registry mirrors for Nexus Docker proxies
# Uses internal ClusterIP (HTTP) to bypass LB VIP intermittent timeouts
# Falls back to upstream registries if Nexus is unavailable
# See: https://github.com/erauner12/omni/issues/2
machine:
  registries:
    mirrors:
      # Docker Hub
      docker.io:
        endpoints:
          - http://nexus-nexus3.registry.svc.cluster.local:5000  # Internal proxy
          - https://registry-1.docker.io                          # Upstream fallback

      # GitHub Container Registry
      ghcr.io:
        endpoints:
          - http://nexus-nexus3.registry.svc.cluster.local:5001
          - https://ghcr.io

      # Quay.io
      quay.io:
        endpoints:
          - http://nexus-nexus3.registry.svc.cluster.local:5002
          - https://quay.io

      # LinuxServer.io
      lscr.io:
        endpoints:
          - http://nexus-nexus3.registry.svc.cluster.local:5003
          - https://lscr.io

      # Kubernetes registry
      registry.k8s.io:
        endpoints:
          - http://nexus-nexus3.registry.svc.cluster.local:5004
          - https://registry.k8s.io

      # AWS ECR Public
      public.ecr.aws:
        endpoints:
          - http://nexus-nexus3.registry.svc.cluster.local:5005
          - https://public.ecr.aws

      # Nexus hosted registry (homelab images)
      # No upstream fallback - this is the source of truth
      docker.nexus.erauner.dev:
        endpoints:
          - http://nexus-nexus3.registry.svc.cluster.local:5010
